# ì‹¤ì‹œê°„ ìŠ¤íŠ¸ë¦¬ë° ê°€ì´ë“œ

## ğŸš€ ì‹¤ì‹œê°„ ìŠ¤íŠ¸ë¦¬ë°ì´ë€?

ê¸°ì¡´ ë°©ì‹ê³¼ ë‹¬ë¦¬, **í˜ì´ì§€ê°€ ì²˜ë¦¬ë  ë•Œë§ˆë‹¤ ì¦‰ì‹œ ê²°ê³¼ë¥¼ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤**.

### Before (ê¸°ì¡´ ë°©ì‹):
```
ì‚¬ìš©ì: PDF ì—…ë¡œë“œ
â†“
[3ë¶„ ëŒ€ê¸°... ì•„ë¬´ ì‘ë‹µ ì—†ìŒ]
â†“
ì„œë²„: ì „ì²´ ê²°ê³¼ ë°˜í™˜ (100ê°œ ë©”ë‰´)
```

### After (ìŠ¤íŠ¸ë¦¬ë°):
```
ì‚¬ìš©ì: PDF ì—…ë¡œë“œ
â†“
ì„œë²„: "ì´ 10í˜ì´ì§€ì…ë‹ˆë‹¤"
â†“ 5ì´ˆ í›„
ì„œë²„: "í˜ì´ì§€ 1 ì™„ë£Œ! (10ê°œ ë©”ë‰´)" â† ì¦‰ì‹œ í‘œì‹œ!
â†“ 5ì´ˆ í›„
ì„œë²„: "í˜ì´ì§€ 2 ì™„ë£Œ! (8ê°œ ë©”ë‰´)"  â† ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸!
â†“
...
```

---

## ğŸ“¡ API ìŠ¤í™

### ì—”ë“œí¬ì¸íŠ¸

```
POST /generate/menus/stream
Content-Type: multipart/form-data
```

### ìš”ì²­
```bash
curl -X POST "http://localhost:8000/generate/menus/stream" \
  -F "file=@recipe.pdf"
```

### ì‘ë‹µ (Server-Sent Events)

#### 1. ì´ˆê¸°í™”
```json
data: {"type": "init", "total_pages": 10}
```

#### 2. ì§„í–‰ ìƒí™© (í˜ì´ì§€ë³„)
```json
data: {
  "type": "progress",
  "page": 1,
  "total_pages": 10,
  "progress": 10,
  "menus": [
    {"name": "ì•„ë©”ë¦¬ì¹´ë…¸", "ingredients": "ìƒ·, ë¬¼"},
    {"name": "ì¹´í˜ë¼ë–¼", "ingredients": "ìƒ·, ìš°ìœ "}
  ],
  "page_time": 5.23
}
```

#### 3. ì™„ë£Œ
```json
data: {
  "type": "complete",
  "total_time": 52.45,
  "total_pages": 10
}
```

#### 4. ì˜¤ë¥˜
```json
data: {
  "type": "error",
  "message": "ì˜¤ë¥˜ ë©”ì‹œì§€"
}
```

---

## ğŸ§ª í…ŒìŠ¤íŠ¸ ë°©ë²•

### 1. ì„œë²„ ì‹¤í–‰
```bash
cd apps/ai
source venv/bin/activate
uvicorn src.main:app --reload --port 8000
```

### 2. ìŠ¤íŠ¸ë¦¬ë° í…ŒìŠ¤íŠ¸
```bash
cd apps/ai
source venv/bin/activate
python test_streaming.py <PDFíŒŒì¼>
```

### ì˜ˆìƒ ì¶œë ¥:
```
============================================================
ğŸ“„ íŒŒì¼: ë©”ê°€ì»¤í”¼_5p.pdf
ğŸ“Š í¬ê¸°: 2.45MB
============================================================

âœ… ì„œë²„ ì—°ê²° ì„±ê³µ: AI server is running

â±ï¸  ìŠ¤íŠ¸ë¦¬ë° í…ŒìŠ¤íŠ¸ ì‹œì‘...

ğŸ“‹ ì´ í˜ì´ì§€: 5
============================================================
ğŸ“„ í˜ì´ì§€ 1/5 ì™„ë£Œ (20%)
   â±ï¸  ì‹œê°„: 7.2ì´ˆ
   ğŸ“‹ ë©”ë‰´: 15ê°œ
   ğŸ½ï¸  ì˜ˆì‹œ: ì•„ë©”ë¦¬ì¹´ë…¸

ğŸ“„ í˜ì´ì§€ 2/5 ì™„ë£Œ (40%)
   â±ï¸  ì‹œê°„: 6.8ì´ˆ
   ğŸ“‹ ë©”ë‰´: 13ê°œ
   ğŸ½ï¸  ì˜ˆì‹œ: ì¹´í˜ë¼ë–¼

...

============================================================
âœ… ìŠ¤íŠ¸ë¦¬ë° ì™„ë£Œ!
============================================================
â±ï¸  ì´ ì‹œê°„: 34.5ì´ˆ
ğŸ“‹ ì´ ë©”ë‰´: 68ê°œ
ğŸ“„ ì´ í˜ì´ì§€: 5
âš¡ í˜ì´ì§€ë‹¹ í‰ê· : 6.9ì´ˆ
============================================================
```

---

## ğŸ†š ê¸°ì¡´ APIì™€ ë¹„êµ

| í•­ëª© | ê¸°ì¡´ API | ìŠ¤íŠ¸ë¦¬ë° API |
|------|----------|--------------|
| **ì—”ë“œí¬ì¸íŠ¸** | `/generate/menus` | `/generate/menus/stream` |
| **ì‘ë‹µ ë°©ì‹** | JSON (í•œ ë²ˆì—) | SSE (ì‹¤ì‹œê°„) |
| **ì²« ê²°ê³¼** | ì „ì²´ ì™„ë£Œ í›„ | ~5ì´ˆ í›„ |
| **ì§„í–‰ ìƒí™©** | ì—†ìŒ | í˜ì´ì§€ë³„ ì‹¤ì‹œê°„ |
| **UX** | 3ë¶„ ëŒ€ê¸° | 5ì´ˆë§ˆë‹¤ ì—…ë°ì´íŠ¸ |
| **ì²˜ë¦¬ ë°©ì‹** | ë³‘ë ¬ (ë¹ ë¦„) | ìˆœì°¨ (ìŠ¤íŠ¸ë¦¬ë°) |
| **ì´ ì‹œê°„** | ~35ì´ˆ (5p) | ~35ì´ˆ (5p) |

**í•µì‹¬**: ì´ ì‹œê°„ì€ ë¹„ìŠ·í•˜ì§€ë§Œ, **ì‚¬ìš©ì ì²´ê°ì€ ì™„ì „íˆ ë‹¤ë¦…ë‹ˆë‹¤**!

---

## ğŸ’¡ ì–¸ì œ ì–´ë–¤ APIë¥¼ ì“¸ê¹Œ?

### ê¸°ì¡´ API (`/generate/menus`) ì¶”ì²œ:
- âœ… ë°±ê·¸ë¼ìš´ë“œ ì‘ì—…
- âœ… ë°°ì¹˜ ì²˜ë¦¬
- âœ… ë¹ ë¥¸ ì‘ë‹µ í•„ìš” (ë³‘ë ¬ ì²˜ë¦¬)

### ìŠ¤íŠ¸ë¦¬ë° API (`/generate/menus/stream`) ì¶”ì²œ:
- âœ… ì‹¤ì‹œê°„ UI ì—…ë°ì´íŠ¸
- âœ… ì§„í–‰ ìƒí™© í‘œì‹œ
- âœ… ì‚¬ìš©ì ì²´ê° ê°œì„ 

---

## ğŸ”§ êµ¬í˜„ ì„¸ë¶€ì‚¬í•­

### ì²˜ë¦¬ íë¦„

```
1. íŒŒì¼ ì—…ë¡œë“œ & OCR
   â†“
2. ê° í˜ì´ì§€ ìˆœì°¨ ì²˜ë¦¬
   â”œâ”€ í˜ì´ì§€ 1 â†’ LLM íŒŒì‹± â†’ ë²ˆì—­ â†’ ì „ì†¡
   â”œâ”€ í˜ì´ì§€ 2 â†’ LLM íŒŒì‹± â†’ ë²ˆì—­ â†’ ì „ì†¡
   â””â”€ ...
   â†“
3. ì™„ë£Œ ë©”ì‹œì§€ ì „ì†¡
```

### ë³‘ë ¬ vs ìˆœì°¨

**ê¸°ì¡´ API (ë³‘ë ¬)**:
```python
# ëª¨ë“  í˜ì´ì§€ë¥¼ ë™ì‹œì— ì²˜ë¦¬
tasks = [process_page(p) for p in pages]
results = await asyncio.gather(*tasks)
# ì „ì²´ ì™„ë£Œ í›„ í•œ ë²ˆì— ë°˜í™˜
```

**ìŠ¤íŠ¸ë¦¬ë° API (ìˆœì°¨)**:
```python
# í˜ì´ì§€ë¥¼ í•˜ë‚˜ì”© ì²˜ë¦¬í•˜ë©° ì¦‰ì‹œ ì „ì†¡
for page in pages:
    result = await process_page(page)
    yield result  # ì¦‰ì‹œ ì „ì†¡!
```

---

## ğŸ“Š ì„±ëŠ¥ ë¹„êµ (ë©”ê°€ì»¤í”¼ 5p ê¸°ì¤€)

### ê¸°ì¡´ API:
```
0ì´ˆ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 35ì´ˆ
         (ëŒ€ê¸°)          âœ… ì™„ë£Œ (68ê°œ ë©”ë‰´)
```

### ìŠ¤íŠ¸ë¦¬ë° API:
```
0ì´ˆ â”€ 7ì´ˆ â”€ 14ì´ˆ â”€ 21ì´ˆ â”€ 28ì´ˆ â”€ 35ì´ˆ
     âœ…    âœ…    âœ…    âœ…    âœ…
    (15ê°œ) (13ê°œ) (14ê°œ) (12ê°œ) (14ê°œ)
```

**ì‚¬ìš©ì ì…ì¥**:
- ê¸°ì¡´: "35ì´ˆ ë™ì•ˆ ì•„ë¬´ê²ƒë„ ì•ˆ ë³´ì„"
- ìŠ¤íŠ¸ë¦¬ë°: "7ì´ˆë§ˆë‹¤ ë©”ë‰´ê°€ ë³´ì„!"

---

## ğŸš¨ ì£¼ì˜ì‚¬í•­

### 1. ì—°ê²° ìœ ì§€
SSEëŠ” **ê¸´ ì—°ê²°**ì„ ìœ ì§€í•©ë‹ˆë‹¤:
- ëª¨ë°”ì¼ ë„¤íŠ¸ì›Œí¬ì—ì„œ ë¶ˆì•ˆì •í•  ìˆ˜ ìˆìŒ
- íƒ€ì„ì•„ì›ƒ ì„¤ì • í•„ìš”

### 2. ìˆœì°¨ ì²˜ë¦¬
ìŠ¤íŠ¸ë¦¬ë°ì€ **ìˆœì°¨ ì²˜ë¦¬**ë¼ì„œ:
- ë³‘ë ¬ë³´ë‹¤ ì „ì²´ ì‹œê°„ì€ ë¹„ìŠ·í•˜ê±°ë‚˜ ì•½ê°„ ëŠë¦¼
- í•˜ì§€ë§Œ **ì²´ê° ì†ë„ëŠ” í›¨ì”¬ ë¹ ë¦„**

### 3. ë²„í¼ë§
Nginx ì‚¬ìš© ì‹œ ë²„í¼ë§ ë¹„í™œì„±í™” í•„ìš”:
```nginx
proxy_buffering off;
X-Accel-Buffering: no;
```

### 4. ì—ëŸ¬ ì²˜ë¦¬
ì¤‘ê°„ì— ì—°ê²°ì´ ëŠì–´ì§ˆ ìˆ˜ ìˆìŒ:
- ì¬ì‹œë„ ë¡œì§ í•„ìš”
- ë¶€ë¶„ ê²°ê³¼ ì €ì¥

---

## ğŸ”œ ë‹¤ìŒ ë‹¨ê³„

### ì„œë²„ ì—°ë™ (Node.js)
```javascript
// apps/server/src/router/upload/streaming.ts
router.post('/upload-recipe-stream', async (req, res) => {
  // AI ì„œë¹„ìŠ¤ ìŠ¤íŠ¸ë¦¬ë° ì—°ê²°
  const response = await fetch('http://ai-service/generate/menus/stream', {
    method: 'POST',
    body: formData
  });

  // SSEë¡œ í´ë¼ì´ì–¸íŠ¸ì— ì „ë‹¬
  for await (const chunk of response.body) {
    res.write(chunk);
  }
});
```

### ëª¨ë°”ì¼ ì•± ì—°ë™ (React Native)
```typescript
// apps/mobile/src/screens/UploadScreen.tsx
const uploadWithStreaming = async (file) => {
  const response = await fetch(API_URL + '/upload-recipe-stream', {
    method: 'POST',
    body: formData
  });

  const reader = response.body.getReader();
  while (true) {
    const {done, value} = await reader.read();
    if (done) break;

    const data = JSON.parse(value);
    if (data.type === 'progress') {
      // ì‹¤ì‹œê°„ìœ¼ë¡œ ë©”ë‰´ ì¶”ê°€
      setMenus(prev => [...prev, ...data.menus]);
      setProgress(data.progress);
    }
  }
};
```

---

## ğŸ“ ìš”ì•½

### âœ… êµ¬í˜„ ì™„ë£Œ:
- AI ì„œë¹„ìŠ¤ ìŠ¤íŠ¸ë¦¬ë° ì—”ë“œí¬ì¸íŠ¸
- í˜ì´ì§€ë³„ ì‹¤ì‹œê°„ ì§„í–‰ ìƒí™© ì „ì†¡
- í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸

### ğŸ”œ ë‹¤ìŒ ì‘ì—…:
- ì„œë²„(Node.js) ì—°ë™
- ëª¨ë°”ì¼ ì•± UI êµ¬í˜„
- ì§„í–‰ë¥  í‘œì‹œ ë°”
- ì˜¤ë¥˜ ì²˜ë¦¬ & ì¬ì‹œë„

---

**ì²´ê° ì†ë„ 3ë°° í–¥ìƒ!** ğŸš€

ê¸°ì¡´: 35ì´ˆ ëŒ€ê¸° â†’ ëª¨ë“  ë©”ë‰´ í‘œì‹œ
ìŠ¤íŠ¸ë¦¬ë°: 7ì´ˆ ëŒ€ê¸° â†’ ì²« ë©”ë‰´ í‘œì‹œ â†’ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸
